# TCGPlayer API Endpoint Implementation Audit

**STATUS: IN PROGRESS** - Successfully extracting endpoint specifications using WebFetch.

## Summary

- **Total Expected Endpoints**: 80 (App: 1, Catalog: 21, Inventory: 4, Pricing: 7, Stores: 47)
- **Current api-endpoints.json Coverage**: 35/80 endpoints (44%) have detailed specifications
- **Implementation Files**: 5 endpoint modules (catalog.py, inventory.py, orders.py, pricing.py, stores.py)

---

## üö® CRITICAL ISSUE: INCOMPLETE API SPECIFICATION

### Current api-endpoints.json Status

**Complete Detailed Specifications (35 endpoints):**
- ‚úÖ **App (1/1 complete)**: Authorize an Application
- ‚úÖ **Catalog (21/21 complete)**: ALL CATALOG ENDPOINTS COMPLETED
  - List All Categories, Get Category Details, Get Category Search Manifest, Search Category Products
  - List All Category Groups, List All Category Rarities, List All Category Printings, List All Category Conditions
  - List All Category Languages, List All Category Media, List All Groups Details, Get Group Details
  - List All Group Media, List All Products, Get Product Details, Get Product Details By GTIN
  - List Product SKUs, List Related Products, List All Product Media Types, Get SKU Details, List Conditions
- ‚úÖ **Pricing (3/7 complete)**: Get Market Price by SKU, List Product Market Prices, List SKU Market Prices, List Product Prices by Group
- ‚úÖ **Stores (7/47 complete)**: Search Stores, Get Store Info, Get Product Inventory Quantities, List Product Summary, Get SKU Quantity, Update SKU inventory, Update SKU Inventory Price

**Missing Detailed Specifications (45 endpoints):**
- ‚úÖ **Catalog**: COMPLETED - All 21/21 endpoints have detailed specifications
- ‚ùå **Inventory**: 4/4 endpoints missing (ALL endpoints)
- ‚ùå **Pricing**: 4/7 endpoints missing (buylist endpoints)  
- ‚ùå **Stores**: 37/47 endpoints missing

### Impact

**Cannot reliably audit endpoint implementations without:**
- Correct API endpoint URLs
- Required path/query parameters
- HTTP methods (GET/POST/PUT)
- Request/response formats

**Key Questions - PARTIALLY RESOLVED:**
1. ‚úÖ **RESOLVED**: Catalog search endpoints do NOT need `/v1.39.0/` version prefix
2. ‚úÖ **PROGRESS**: Parameter names and types extracted for 9 critical endpoints
3. ‚ùì **PENDING**: Endpoint path validation against current implementation (requires remaining 71 specs)

---

## IMPLEMENTATION PLAN

### Phase 1: Complete API Specification (REQUIRED FIRST)

**Use WebFetch tool to extract missing endpoint details from TCGplayer documentation (Playwright approach abandoned):**

#### Priority 1: Critical Endpoints (13 endpoints)
1. **Catalog Search Endpoints** (resolve version prefix question):
   - Get Category Search Manifest
   - Search Category Products

2. **Core Pricing Endpoints** (market data critical):
   - Get Market Price by SKU
   - List Product Market Prices
   - List SKU Market Prices
   - List Product Prices by Group

3. **Essential Store Endpoints** (basic store operations):
   - Search Stores
   - Get Store Info
   - Get Product Inventory Quantities
   - List Product Summary
   - Get SKU Quantity
   - Update SKU inventory
   - Update SKU Inventory Price

#### Priority 2: Remaining Catalog Endpoints (19 endpoints)
- List All Category Groups
- List All Category Rarities  
- List All Category Printings
- List All Category Conditions
- List All Category Languages
- List All Category Media
- List All Groups Details
- Get Group Details
- List All Group Media
- List All Products
- Get Product Details
- Get Product Details By GTIN
- List Product SKUs
- List Related Products
- List All Product Media Types
- Get SKU details
- List Conditions

#### Priority 3: Remaining Pricing Endpoints (4 endpoints)
- List Product Buylist Prices
- List SKU Buylist Prices
- List Product Buylist Prices by Group

#### Priority 4: All Inventory Endpoints (4 endpoints)
- Get ProductList By Id
- Get ProductList By Key
- List All ProductLists
- Create ProductList

#### Priority 5: Remaining Store Endpoints (34 endpoints)
All remaining store endpoints including:
- Buylist management endpoints
- Customer management endpoints
- Order management endpoints (currently in separate orders.py)
- Advanced inventory operations
- Store configuration endpoints

### Phase 2: Re-Audit Implementation (AFTER Phase 1 Complete)

**With complete API specification, perform full implementation audit:**

1. **Catalog Endpoints**: Verify 21 implementations against specification
2. **Inventory Endpoints**: Verify 4 implementations against specification  
3. **Pricing Endpoints**: Verify pricing.py implementations against specification
4. **Orders Endpoints**: Verify if should be moved to stores.py (architectural decision)
5. **Stores Endpoints**: Verify 47 implementations against specification

**Audit Criteria:**
- ‚úÖ Correct API endpoint URLs
- ‚úÖ Proper HTTP methods
- ‚úÖ Required parameters implemented
- ‚úÖ Optional parameters supported
- ‚úÖ Error handling appropriate
- ‚úÖ Type hints correct
- ‚úÖ Documentation complete

---

## TODO LIST FOR PLAYWRIGHT SCRAPING

### Setup Tasks
- [ ] Create Playwright scraping script for TCGplayer documentation
- [ ] Test scraping on 2-3 sample endpoints to verify data extraction
- [ ] Create JSON schema for detailed endpoint specifications
- [ ] Set up batch processing for all 77 missing endpoints

### Scraping Tasks by Priority

**Priority 1: Critical Endpoints (13)** - **‚úÖ ALL 13/13 COMPLETED**
- [‚úÖ] **COMPLETED**: Get Category Search Manifest
  - URL: `https://api.tcgplayer.com/catalog/categories/{categoryId}/search/manifest`
  - Method: GET | Auth: Bearer Token | Returns sorting options and filters
- [‚úÖ] **COMPLETED**: Search Category Products  
  - URL: `https://api.tcgplayer.com/catalog/categories/{categoryId}/search`
  - Method: POST | Auth: Bearer Token | Accepts filters, sorting, pagination
- [‚úÖ] **COMPLETED**: Get Market Price by SKU
  - URL: `https://api.tcgplayer.com/pricing/marketprices/{productconditionId}`
  - Method: GET | Returns single SKU market price with ranges
- [‚úÖ] **COMPLETED**: List Product Market Prices
  - URL: `https://api.tcgplayer.com/pricing/product/{productIds}`
  - Method: GET | Comma-separated productIds | Returns comprehensive pricing
- [‚úÖ] **COMPLETED**: List SKU Market Prices
  - URL: `https://api.tcgplayer.com/pricing/sku/{skuIds}`
  - Method: GET | Comma-separated skuIds | Returns SKU-level pricing
- [‚úÖ] **COMPLETED**: List Product Prices by Group
  - URL: `https://api.tcgplayer.com/pricing/group/{groupId}`
  - Method: GET | Returns comprehensive pricing for product group/set
- [‚úÖ] **COMPLETED**: Search Stores
  - URL: `https://api.tcgplayer.com/stores`
  - Method: GET | Optional name parameter | Returns store keys
- [‚úÖ] **COMPLETED**: Get Store Info 
  - URL: `https://api.tcgplayer.com/stores/self`
  - Method: GET | Auth: Bearer Token | Returns current store info
- [‚úÖ] **COMPLETED**: Get Product Inventory Quantities
  - URL: `https://api.tcgplayer.com/stores/{storeKey}/inventory/products/{productId}/quantity`
  - Method: GET | Auth: Bearer Token | Returns product inventory quantities
- [‚úÖ] **COMPLETED**: List Product Summary
  - URL: `https://api.tcgplayer.com/stores/{storeKey}/inventory/products`
  - Method: GET | Auth: Bearer Token | Returns all store products with details
- [‚úÖ] **COMPLETED**: Get SKU Quantity
  - URL: `https://api.tcgplayer.com/stores/{storeKey}/inventory/skus/{skuId}/quantity`
  - Method: GET | Auth: Bearer Token | Returns specific SKU quantity
- [‚úÖ] **COMPLETED**: Update SKU inventory
  - URL: `https://api.tcgplayer.com/stores/{storeKey}/inventory/skus/{skuId}`
  - Method: PUT | Auth: Bearer Token | Updates SKU price, quantity, channel
- [‚úÖ] **COMPLETED**: Update SKU Inventory Price
  - URL: `https://api.tcgplayer.com/stores/{storeKey}/inventory/skus/{skuId}/price`
  - Method: PUT | Auth: Bearer Token | Updates SKU pricing

**KEY FINDING**: Catalog search endpoints do NOT use version prefix (e.g., `/v1.39.0/`)

**Priority 2: Catalog Endpoints (19)**
- [ ] Scrape all remaining catalog endpoints (list in Priority 2 above)

**Priority 3: Pricing Endpoints (4)**
- [ ] Scrape all buylist pricing endpoints

**Priority 4: Inventory Endpoints (4)**
- [ ] Scrape all inventory endpoints

**Priority 5: Store Endpoints (34)**
- [ ] Scrape all remaining store endpoints

### Validation Tasks
- [ ] Validate scraped data completeness for each endpoint
- [ ] Cross-reference with existing implementation to identify discrepancies
- [ ] Update api-endpoints.json with complete detailed specifications
- [ ] Verify version prefix requirements for search endpoints

---

## CONTEXT FOR NEXT CHAT SESSION

**Situation**: 
- Working on TCGplayer Python client endpoint implementation audit
- Discovered api-endpoints.json is 96.25% incomplete (only 3/80 endpoints detailed)
- Cannot reliably audit implementations without complete API specification
- Need to use Playwright to scrape missing endpoint details from documentation

**Current Status**:
- ‚úÖ **COMPLETED**: Priority 1 Critical Endpoints - ALL 13/13 endpoint specifications extracted
- ‚úÖ **RESOLVED**: Version prefix question - catalog search endpoints do NOT use `/v1.39.0/`
- ‚úÖ **SUCCESS**: WebFetch approach working efficiently for endpoint extraction
- ‚úÖ **IMPROVED**: Coverage from 20% to 44% (35/80 detailed specifications)
- ‚úÖ **MAJOR MILESTONE**: All 21 Catalog endpoints now have complete detailed specifications
- ‚úÖ Identified architectural issues (orders should be in stores)
- ‚ùå **CONTINUING**: Need remaining 45 endpoint specifications for complete audit

**Immediate Next Steps**:
1. ‚úÖ **COMPLETED**: Priority 1 critical endpoints - ALL 13/13 completed
2. ‚úÖ **COMPLETED**: Priority 2 catalog endpoints - ALL 19/19 completed
3. ‚úÖ **COMPLETED**: WebFetch approach established and working efficiently  
4. ‚úÖ **COMPLETED**: api-endpoints.json updated with 35 detailed specifications (44% coverage)
5. **NEXT**: Continue with Priority 3 Pricing Endpoints (4 buylist endpoints)
6. **PENDING**: Re-run full implementation audit with complete data

**Files Modified**:
- `ENDPOINT_ERRORS.md` - Updated with current progress and findings
- `api-endpoints.json` - Updated with 35 detailed endpoint specifications (up from 16)
- `CLAUDE.md` - Contains project context and development guidance

**Key Insights**: 
- WebFetch tool is highly efficient for systematic endpoint specification extraction
- Catalog search endpoints confirmed to NOT use version prefixes
- Systematic approach working: improved from 20% to 44% coverage in one session
- Major milestone: ALL catalog endpoints (21/21) now have complete specifications
- Ready to continue with remaining 45 endpoints (4 inventory + 4 pricing + 37 stores)